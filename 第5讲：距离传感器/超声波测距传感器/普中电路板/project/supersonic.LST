C51 COMPILER V9.60.0.0   SUPERSONIC                                                        05/17/2024 15:55:00 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE SUPERSONIC
OBJECT MODULE PLACED IN supersonic.OBJ
COMPILER INVOKED BY: E:\danpianji\Keil 5\C51\BIN\C51.EXE supersonic.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2
                    -)

line level    source

   1          #include <supersonic.h>
   2          #define VELOCITY_30C  3495  //30摄氏度时的声速，声速V= 331.5 + 0.6*温度；速度扩大了10倍， 
   3          #define VELOCITY_23C  3453  //23摄氏度时的声速，声速V= 331.5 + 0.6*温度；速度扩大了10倍，
   4          
   5          sbit ECHO = P2^0;  //回声接收端口
   6          sbit TRIG = P2^1;  //超声触发端口
   7          
   8          u8 count;
   9          
  10          void Init_Timer0(void)//定时器0初始化
  11          {
  12   1        TMOD = TMOD&0xf0;  //定时器0初始化,设置为：工作方式1(16位计数值)
  13   1        TMOD = TMOD|0x01;  //定时器0初始化,设置为：工作方式1(16位计数值)
  14   1        TL0 = 0x66;
  15   1        TH0 = 0xfc;  //定时1ms
  16   1          EA = 1;    //总中断使能
  17   1        ET0 = 1;   //开定时器0  
  18   1      }
  19          
  20          void Init_Supersonic()//超声波传感器初始化
  21          {
  22   1         TRIG =0;
  23   1         ECHO = 0;
  24   1         count = 0;
  25   1         Init_Timer0();
  26   1      }
  27          
  28          void Trig_SuperSonic()//发出声波
  29          {
  30   1         TRIG = 1;
  31   1         delay_us(10); //延时10微秒;
  32   1         TRIG = 0;
  33   1      }
  34          
  35          
  36          u32 Measure_Distance()//计算距离函数,返回为距离值，单位mm  
  37          {
  38   1        u32 distance=0;    //距离变量
  39   1        u8 l;
  40   1        u16 h,y;
  41   1      
  42   1      
  43   1        Trig_SuperSonic(); //发出声波
  44   1      
  45   1        while(ECHO == 0);  //等待回声
  46   1          
  47   1        TR0 = 1;
  48   1        while(ECHO);  
  49   1        TR0 = 0;
  50   1      
  51   1        l = TL0;
  52   1        h = TH0;
  53   1        y = (h << 8) + l;//将计数值转换为16位
  54   1        y = y - 0xfc66;//us部分，不足1ms的时间
C51 COMPILER V9.60.0.0   SUPERSONIC                                                        05/17/2024 15:55:00 PAGE 2   

  55   1        distance = y + 1000 * count;
  56   1        count = 0;
  57   1      //计算总时间(单位us)=若干(count)ms+us(y)
  58   1        TL0 = 0x66;
  59   1        TH0 = 0xfc;
  60   1        delay_us(30);
  61   1        distance = VELOCITY_30C * distance / 20000;//距离单位换算成MM
  62   1        return distance;
  63   1      }
  64          
  65          void timer0 () interrupt 1//T0中断处理函数  
  66          {
  67   1        TL0 = 0x66;
  68   1        TH0 = 0xfc;
  69   1        count++;
  70   1        if(count == 18)//超声波回声脉宽最多18ms
  71   1        {
  72   2          TR0 =0;
  73   2          TL0 = 0x66;
  74   2          TH0 = 0xfc;
  75   2          count = 0;
  76   2        }
  77   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    191    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
