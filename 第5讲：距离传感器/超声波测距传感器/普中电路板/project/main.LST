C51 COMPILER V9.60.0.0   MAIN                                                              05/17/2024 15:55:00 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: E:\danpianji\Keil 5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          //基于天祥电路板
   2          #include <config.h>
   3          #include <supersonic.h> 
   4          #include <1602.h> 
   5          
   6          
   7          sbit beep=P3^3;//蜂鸣器 
   8          
   9          u8 flag=0;  //0:叮,1:咚
  10          u16 n0=0,n1=0;  //n0:叮周期计数，n1:咚周期计数
  11          
  12          void delay_us(u16 n)//微秒延时
  13          {
  14   1          while(--n);
  15   1      }
  16          
  17          void delay_ms(u16 x)//毫秒延时函数
  18          {u16 i,j;
  19   1       for(i=0;i<x;i++)
  20   1          for(j=0;j<115;j++);
  21   1      }
  22          
  23          void Alarm(u8 t) //蜂鸣器报警,持续t秒,软件延时
  24          {
  25   1       u8 k; 
  26   1       u16 i,j;     
  27   1       for(k=0;k<t;k++)
  28   1       { for(i=0;i<100;i++)//叮
  29   2            {beep=0;delay_us(250);beep=1;delay_us(250);}
  30   2         for(j=0;j<50;j++)//咚
  31   2            {beep=0;delay_us(500);beep=1;delay_us(500);}
  32   2       }
  33   1      }
  34          
  35          void Alarm_init() //蜂鸣器报警,定时器T0
  36          {
  37   1        TMOD&=0xf0;//定时器T0设为方式2,8位自动装载模式
  38   1          TMOD|=0x02;  
  39   1        TH0=0X00;
  40   1        TL0=0X00; //定时250us
  41   1        EA=1;
  42   1        ET0=1;
  43   1      }
  44          
  45          void Alarm_Power(u8 t) //打开/关闭蜂鸣器报警,定时器T0,1：打开，0：关闭
  46          {
  47   1        TR0=t; 
  48   1      }
  49          
  50          void main()
  51          {
  52   1        u8 print[10];
  53   1        float distance;  
  54   1      
  55   1        LCD1602_Init();//1602初始化
C51 COMPILER V9.60.0.0   MAIN                                                              05/17/2024 15:55:00 PAGE 2   

  56   1        Init_Supersonic();  //超声波传感器初始化
  57   1      
  58   1      //  Alarm_Init();//蜂鸣器(定时器T0)初始化
  59   1      
  60   1        while(1)
  61   1        {   
  62   2          distance=Measure_Distance();//计算脉宽并转换为距离，单位mm
  63   2          sprintf(print,"%.1f",distance);
  64   2          
  65   2          LCD1602_disstr(print,0,0);//输出到1602液晶显示屏
  66   2         
  67   2        }
  68   1      }
  69          
  70          //叮(一个周期高250us低250us，共500个周期，0.25秒)，咚(一个周期高500us低500us，共250个周期，0.25秒)
  71          void time0() interrupt 1
  72          {
  73   1        if(flag==0)
  74   1        {  
  75   2          n0++;
  76   2          if(n0==1000)    
  77   2          {
  78   3            n0=0;
  79   3            flag=1;
  80   3          }
  81   2          else
  82   2          {
  83   3            beep=~beep;
  84   3          }
  85   2        }
  86   1        else
  87   1        {            //通过改变定时计数时间可以改变门铃的声音
  88   2          n1++;       //叮
  89   2          if(n1==1000)
  90   2          {
  91   3            n1=0;
  92   3            TR0=0;
  93   3            flag=0;
  94   3          }
  95   2          else
  96   2          {
  97   3            if(n1%2==0) beep=~beep;
  98   3          }
  99   2        }
 100   1      }                                


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    283    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
