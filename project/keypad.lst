C51 COMPILER V9.00   KEYPAD                                                                11/09/2021 22:08:45 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE KEYPAD
OBJECT MODULE PLACED IN .\output\keypad.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE app\keypad.c BROWSE INCDIR(.\app) DEBUG OBJECTEXTEND PRINT(.\keypad.lst) OB
                    -JECT(.\output\keypad.obj)

line level    source

   1          #include <keypad.h>     
   2          
   3          #define MATRIX P1       //宏定义矩阵按键行列引脚，低4位为列线，高4位为行线
   4          
   5          u8 keypad4_4()//4行4列矩阵按键扫描函数:要去抖，若有按键按下，返回对应的按键值(0-15),没有按键按下返回16
   6          {
   7   1              u8 i,row,temp;
   8   1              u8 key=16;//按键号，初值设置为16，目的是：没有按键按下时返回16；
   9   1                    //注意：若不设初值(默认值为0)，没有按键按下时，将返回0，会误认为0被按下  
  10   1              //按列扫描
  11   1              row=0xf7; //初始列信号      
  12   1              for(i=0;i<4;i++)//循环扫描4列
  13   1              {
  14   2                      MATRIX=0xff;//清除之前的信号  
  15   2                      MATRIX=row;     //输出列信号，第i列信号，对应第i列为低，其他全为高
  16   2                      row=_cror_(row,1);        //循环左移，生成下一个列信号
  17   2                      temp=MATRIX; //读入扫描信号
  18   2                      temp=temp&0xf0; //屏蔽低4位列信号，只保留高4位行信号 
  19   2                      if(temp!=0xf0)//有按键被按下，因为第i列某行有按键按下，则高4位行信号中有一位为低电平  
  20   2                      {  
  21   3                              delay_ms(10);  //延时去抖
  22   3                              temp=MATRIX;   //再次读入扫描信号
  23   3                              temp=temp&0xf0;  //屏蔽低4位列信号，只保留高4位行信号 
  24   3                              if(temp!=0xf0)   //再次确认有按键被按下
  25   3                              {  
  26   4                              switch(temp)  //根据低4位行信号，判断哪个按键被按下
  27   4                          {  
  28   5                              case 0x70:key=0+i;break; //第i列第1行按键被按下 
  29   5                              case 0xb0:key=4+i;break; //第i列第2行按键被按下  
  30   5                              case 0xd0:key=8+i;break; //第i列第3行按键被按下
  31   5                                              case 0xe0:key=12+i;      //第i列第4行按键被按下 
  32   5                          }
  33   4                                      
  34   4                                      do
  35   4                                      {
  36   5                                              temp=MATRIX;        //再次扫描按键，检测按键是否释放
  37   5                                              temp=temp&0xf0;         //屏蔽高4位列信号，只保留低4位行信号
  38   5                                      }while(temp!=0xf0); //等待按键释放   
  39   4                              }  
  40   3                   }
  41   2              }  
  42   1              return(key);//扫描结束，返回按键值
  43   1      }
  44          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    119    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.00   KEYPAD                                                                11/09/2021 22:08:45 PAGE 2   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
