C51 COMPILER V9.00   MAIN                                                                  04/26/2024 12:29:56 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: D:\app\kile\C51\BIN\C51.EXE app\main.c BROWSE INCDIR(.\app) DEBUG OBJECTEXTEND PRINT(.\main.lst) OB
                    -JECT(.\output\main.obj)

line level    source

   1          /******************************包含头文件*******************************/
   2          #include <config.h>
   3          #include <ds18b20.h>
   4          #include <smg.h>
   5          sbit buzzer=P2^5;
   6          
   7          sbit Led=P2^0;
   8          float temp=0;
   9          u16 count_1000ms=0;
  10          u8 count_200ms=0;
  11          bit flag=1;
  12          /***********************************主函数***********************************/
  13          void timer0_init()//定时器T0定时1毫秒@12.000MHz
  14          {
  15   1          TMOD&= 0xF0;
  16   1          TMOD|= 0x01;    //设置定时器T0工作模式：软启动、定时、工作方式1-16位计数值
  17   1          TL0 = 0x18;        //设置定时初值，定时1ms
  18   1          TH0 = 0xFC;        
  19   1          TF0 = 0;        //清除TF0标志
  20   1          TR0 = 1;        //定时器0开始计时
  21   1          ET0=1;            //允许定时器0中断
  22   1          EA=1;            //开中断 
  23   1      }
  24          void main()    //主函数
  25          { 
  26   1          
  27   1          char display[10];
  28   1          
  29   1          timer0_init();
  30   1          while(1)
  31   1          {
  32   2              sprintf(display,"%.2f",temp);
  33   2              smg_str(display);
  34   2              if(temp>30 &&temp<45){
  35   3                  Led=0;
  36   3                  flag=1;
  37   3              }
  38   2              else{
  39   3                  
  40   3                  flag=0;
  41   3              }
  42   2              
  43   2      }      
  44   1          
  45   1          
  46   1      }
  47          
  48          
  49          
  50          void timer0_int() interrupt 1//定时器0定时1ms中断服务函数
  51          {
  52   1      //定时器T0工作方式1的16位计数值不能自动重装，需要每次中断设置初值
  53   1          TL0 = 0x18;        //设置定时初值
  54   1          TH0 = 0xFC;        
C51 COMPILER V9.00   MAIN                                                                  04/26/2024 12:29:56 PAGE 2   

  55   1          ++count_200ms;
  56   1          if(++count_1000ms==1000)
  57   1          {
  58   2              count_1000ms=0;
  59   2              Ds18b20_Tempchg();
  60   2              temp=Ds18b20_Gettemp(); //读取寄存器中存储的温度数据        
  61   2              
  62   2          }
  63   1          //灯
  64   1          if(flag==0){
  65   2              buzzer=!buzzer;
  66   2              
  67   2              if(count_200ms==100)
  68   2              {
  69   3                  Led=1;
  70   3              }
  71   2              if(count_200ms==200)
  72   2              {
  73   3              
  74   3                  Led=0;
  75   3                  
  76   3                  count_200ms=0;
  77   3              }
  78   2              
  79   2          }
  80   1          
  81   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    238    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
