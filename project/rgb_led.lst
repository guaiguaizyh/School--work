C51 COMPILER V9.60.0.0   RGB_LED                                                           04/19/2024 16:21:12 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE RGB_LED
OBJECT MODULE PLACED IN .\output\rgb_led.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE app\rgb_led.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\app) DEBUG OBJECTEXTEND 
                    -PRINT(.\rgb_led.lst) TABS(2) OBJECT(.\output\rgb_led.obj)

line level    source

   1          #include <rgb_led.h>
   2          
   3          sbit SCL= P2^1;   //时钟线
   4          sbit SDA= P2^0;  //数据线
   5          
   6          //发送前32位'0'起始帧
   7          void RGBLED_Send32Zero( )
   8          {
   9   1         u8 i;
  10   1        
  11   1         SDA = 0;
  12   1         for(i=0;i<32;i++)
  13   1         {
  14   2            SCL = 0;
  15   2              delay_10xus(20);
  16   2              SCL = 1;
  17   2              delay_10xus(20);    
  18   2         } 
  19   1      }
  20          
  21          //反转前两位的灰度值
  22          u8 RGBLED_TakeAntiCode(u8 dat)
  23          {
  24   1         u8 tmp = 0;
  25   1        
  26   1         tmp = ((~dat) & 0xC0) >> 6;
  27   1         return tmp;
  28   1      }
  29          
  30          //发送灰度数据
  31          void RGBLED_DatSend(u32 dx)
  32          {
  33   1         u8 i;
  34   1         
  35   1         for(i=0;i<32;i++)
  36   1         {
  37   2          if((dx & 0x80000000) !=0)
  38   2           SDA=1;
  39   2          else 
  40   2             SDA=0; 
  41   2          dx<<=1;
  42   2          SCL=0;delay_10xus(20);
  43   2          SCL=1;delay_10xus(20);
  44   2         }  
  45   1      }
  46          
  47          //数据处理与发送
  48          //r;红色值 0~255
  49          //g:绿色值 0~255
  50          //b:蓝色值 0~255  
  51          void RGBLED_DataDealWithAndSend(u8 r,u8 g,u8 b)
  52          { 
  53   1         u32 dx=0;
  54   1        
C51 COMPILER V9.60.0.0   RGB_LED                                                           04/19/2024 16:21:12 PAGE 2   

  55   1         dx |= (u32)0x03 << 30;  //前两位'1'位标志位
  56   1         dx |= (u32)RGBLED_TakeAntiCode(b) << 28;
  57   1         dx |= (u32)RGBLED_TakeAntiCode(g) << 26;
  58   1         dx |= (u32)RGBLED_TakeAntiCode(r) << 24;
  59   1         dx |= (u32)b << 16;
  60   1         dx |= (u32)g << 8;
  61   1         dx |= r;
  62   1        
  63   1         RGBLED_DatSend(dx);//发送数据  
  64   1      }
  65          //RGB灯控制函数
  66          //r;红色值 0~255
  67          //g:绿色值 0~255
  68          //b:蓝色值 0~255
  69          void RGBLED_Show(u8 r,u8 g,u8 b)
  70          {
  71   1         RGBLED_Send32Zero();//发送前32位'0'起始帧
  72   1         RGBLED_DataDealWithAndSend(r, g, b);//发送32bit灰度数据
  73   1           RGBLED_DataDealWithAndSend(r, g, b);
  74   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    391    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
