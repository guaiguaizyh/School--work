C51 COMPILER V9.00   DS1302                                                                11/15/2021 22:25:16 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\output\ds1302.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE app\ds1302.c BROWSE INCDIR(.\app) DEBUG OBJECTEXTEND PRINT(.\ds1302.lst) OB
                    -JECT(.\output\ds1302.obj)

line level    source

   1          #include <ds1302.h>
   2          
   3          sbit SCK=P3^6;          
   4          sbit SDA=P3^4;          
   5          sbit RST=P3^5;   // DS1302∏¥Œª                                                                                          
   6          
   7          void Write_Ds1302(u8 temp) 
   8          {
   9   1              u8 i;
  10   1              for (i=0;i<8;i++)       
  11   1              { 
  12   2                      SCK=0;
  13   2                      _nop_();
  14   2                      SDA=temp&0x01;
  15   2                      temp>>=1; 
  16   2                      SCK=1;
  17   2                      _nop_();
  18   2              }
  19   1      }   
  20          
  21          void Write_Ds1302_Byte(u8 address,u8 dat )     
  22          {
  23   1              RST=0;  _nop_();
  24   1              SCK=0;  _nop_();
  25   1              RST=1;  _nop_();  
  26   1              Write_Ds1302(address);  
  27   1              Write_Ds1302(dat);              
  28   1              RST=0; 
  29   1      }
  30          
  31          u8 Read_Ds1302_Byte ( u8 address )
  32          {
  33   1              u8 i,temp=0x00;
  34   1              RST=0;  _nop_();
  35   1              SCK=0;  _nop_();
  36   1              RST=1;  _nop_();
  37   1              Write_Ds1302(address);
  38   1              for (i=0;i<8;i++)       
  39   1              {               
  40   2                      SCK=0;
  41   2                      temp>>=1;       
  42   2                      if(SDA)
  43   2                      temp|=0x80;     
  44   2                      SCK=1;
  45   2              } 
  46   1              RST=0;  _nop_();
  47   1              SCK=0;  _nop_();
  48   1              SCK=1;  _nop_();
  49   1              SDA=0;  _nop_();
  50   1              SDA=1;  _nop_();
  51   1              return (temp);                  
  52   1      }
  53          
  54          void  ReadRTCTime(u8 * GetTime) //∂¡≥ˆ ±÷”÷µ¥Ê∑≈µΩGetTime÷–£¨“¿¥Œ¥Ê∑≈µƒ «–° ±°¢ ±°¢∑÷÷”°¢√Î÷µ£¨»Á{23,59,50
C51 COMPILER V9.00   DS1302                                                                11/15/2021 22:25:16 PAGE 2   

             -}£¨º¥23:59:50
  55          {
  56   1              u8 temp;
  57   1              
  58   1              temp = Read_Ds1302_Byte(0x85); // ∂¡≥ˆ–° ±÷µ
  59   1              GetTime[0] = (temp>>4)*10+(temp&0xf); //Ω´BCD¬Î◊™ªª≥… ÆΩ¯÷∆ ˝£¨¥Ê»ÎGetRTC÷–
  60   1              
  61   1              temp = Read_Ds1302_Byte(0x83);  // ∂¡≥ˆ∑÷÷”÷µ
  62   1              GetTime[1] = (temp>>4)*10+(temp&0xf);
  63   1      
  64   1              temp = Read_Ds1302_Byte(0x81); // ∂¡≥ˆ√Î÷µ
  65   1              GetTime[2] = (temp>>4)*10+(temp&0xf);
  66   1      
  67   1      }
  68          void  ReadRTCDate(u8 * GetDate) //∂¡≥ˆ»’∆⁄÷µ¥Ê∑≈µΩGetDate÷–£¨“¿¥Œ¥Ê∑≈µƒ «ƒÍ°¢‘¬°¢»’°¢–«∆⁄£¨»Á{21,3,27£¨7}£
             -¨º¥21ƒÍ3‘¬27»’–«∆⁄7
  69          {
  70   1              u8 temp;
  71   1              
  72   1              temp = Read_Ds1302_Byte(0x8D); // ∂¡≥ˆƒÍ∑›÷µ
  73   1              GetDate[0] = (temp>>4)*10+(temp&0xf); //Ω´BCD¬Î◊™ªª≥… ÆΩ¯÷∆ ˝£¨¥Ê»ÎGetRTC÷–
  74   1              
  75   1              temp = Read_Ds1302_Byte(0x89);  // ∂¡≥ˆ‘¬∑›÷µ
  76   1              GetDate[1] = (temp>>4)*10+(temp&0xf);
  77   1      
  78   1              temp = Read_Ds1302_Byte(0x87); // ∂¡≥ˆ»’∆⁄÷µ
  79   1              GetDate[2] = (temp>>4)*10+(temp&0xf);
  80   1      
  81   1              temp = Read_Ds1302_Byte(0x8B); // ∂¡≥ˆ–«∆⁄÷µ
  82   1              GetDate[3] = (temp>>4)*10+(temp&0xf);
  83   1      
  84   1      }
  85          void SetRTCDate(u8 *SetDate) //…Ë÷√»’∆⁄
  86          //SetDate÷–“¿¥Œ¥Ê∑≈µƒ «ƒÍ°¢‘¬°¢»’°¢–«∆⁄£¨»Á{21,3,27,7}£¨º¥21ƒÍ3‘¬27»’–«∆⁄7
  87          {
  88   1              u8 temp;
  89   1              
  90   1              Write_Ds1302_Byte(0x8E,0X00);   //‘ –Ì–¥≤Ÿ◊˜
  91   1              
  92   1              //…Ë÷√»’∆⁄÷µ
  93   1              temp = ((SetDate[0]/10)<<4)+SetDate[0]%10;      //…Ë÷√ƒÍ÷µ£¨Ω´ ÆΩ¯÷∆ ˝◊™ªª≥…BCD¬Î
  94   1              Write_Ds1302_Byte(0x8C, temp);  //–¥»Î
  95   1      
  96   1              temp = ((SetDate[1]/10)<<4)+SetDate[1]%10;               //…Ë÷√‘¬÷µ
  97   1              Write_Ds1302_Byte(0x88, temp);   //–¥»Î
  98   1      
  99   1              temp = ((SetDate[2]/10)<<4)+SetDate[2]%10;                //…Ë÷√»’÷µ
 100   1              Write_Ds1302_Byte(0x86, temp);  //–¥»Î
 101   1      
 102   1              temp = ((SetDate[3]/10)<<4)+SetDate[2]%10;                //…Ë÷√–«∆⁄÷µ
 103   1              Write_Ds1302_Byte(0x8A, temp);  //–¥»Î
 104   1              
 105   1              Write_Ds1302_Byte(0x8E,0x80);    //Ω˚÷π–¥≤Ÿ◊˜
 106   1      }
 107          void SetRTCTime(u8 *SetTime) //…Ë÷√ ±÷”
 108          //SetTime÷–“¿¥Œ¥Ê∑≈µƒ «–° ±°¢∑÷÷”°¢√Î÷µ£¨»Á{23,59,50}£¨º¥23:59:50
 109          {
 110   1              u8 temp;
 111   1              
 112   1              Write_Ds1302_Byte(0x8E,0X00);   //‘ –Ì–¥≤Ÿ◊˜
 113   1              
 114   1              //…Ë÷√ ±º‰÷µ
C51 COMPILER V9.00   DS1302                                                                11/15/2021 22:25:16 PAGE 3   

 115   1              temp = ((SetTime[0]/10)<<4)+SetTime[0]%10;      //…Ë÷√–° ±÷µ£¨Ω´ ÆΩ¯÷∆ ˝◊™ªª≥…BCD¬Î
 116   1              Write_Ds1302_Byte(0x84, temp);  //–¥»Î
 117   1      
 118   1              temp = ((SetTime[1]/10)<<4)+SetTime[1]%10;               //…Ë÷√∑÷÷”÷µ
 119   1              Write_Ds1302_Byte(0x82, temp);   //–¥»Î
 120   1      
 121   1              temp = ((SetTime[2]/10)<<4)+SetTime[2]%10;                //…Ë÷√√Î÷µ
 122   1              Write_Ds1302_Byte(0x80, temp);  //–¥»Î  
 123   1              
 124   1              Write_Ds1302_Byte(0x8E,0x80);    //Ω˚÷π–¥≤Ÿ◊˜
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    476    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
