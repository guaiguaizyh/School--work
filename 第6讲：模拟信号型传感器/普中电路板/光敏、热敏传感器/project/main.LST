C51 COMPILER V9.00   MAIN                                                                  12/18/2019 21:19:13 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\KEIL\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //基于天祥电路板
   2          #include <config.h>
   3          #include <pcf8591.h> 
   4          #include <uart.h> 
   5            
   6          sbit beep=P2^3;//蜂鸣器 
   7          
   8          u8 flag=0;      //0:叮,1:咚
   9          u16 n0=0,n1=0;  //n0:叮周期计数，n1:咚周期计数
  10          
  11          void delay_us(u16 n)//微秒延时
  12          {
  13   1          while(--n);
  14   1      }
  15          
  16          void delay_ms(u16 x)//毫秒延时函数
  17          {u16 i,j;
  18   1       for(i=0;i<x;i++)
  19   1          for(j=0;j<115;j++);
  20   1      }
  21          
  22          void Alarm(u8 t) //蜂鸣器报警,持续t秒,软件延时
  23          {
  24   1       u8 k; 
  25   1       u16 i,j;               
  26   1       for(k=0;k<t;k++)
  27   1       { for(i=0;i<100;i++)//叮
  28   2            {beep=0;delay_us(250);beep=1;delay_us(250);}
  29   2         for(j=0;j<50;j++)//咚
  30   2            {beep=0;delay_us(500);beep=1;delay_us(500);}
  31   2       }
  32   1      }
  33          
  34          void Alarm_init() //蜂鸣器报警,定时器T0
  35          {
  36   1              TMOD&=0xf0;//定时器T0设为方式2,8位自动装载模式
  37   1          TMOD|=0x02;  
  38   1              TH0=0X00;
  39   1              TL0=0X00; //定时250us
  40   1              EA=1;
  41   1              ET0=1;
  42   1      }
  43          
  44          void Alarm_Power(u8 t) //打开/关闭蜂鸣器报警,定时器T0,1：打开，0：关闭
  45          {
  46   1              TR0=t; 
  47   1      }
  48          
  49          void main()
  50          {
  51   1              u8 DATA[3],print[10];
  52   1              float value;
  53   1      
  54   1              uart_init(4800);//串口初始化
  55   1      
C51 COMPILER V9.00   MAIN                                                                  12/18/2019 21:19:13 PAGE 2   

  56   1      //      Alarm_Init();//蜂鸣器(定时器T0)初始化
  57   1      
  58   1              while(1)
  59   1              {       
  60   2              //连续将多个通道模拟信号转换为数字信号，注意本次读出的数字值是上一次的转换结果
  61   2                      DATA[0]=Pcf8591_AD(0);//通道0：光敏
  62   2                      DATA[1]=Pcf8591_AD(0);//通道1：热敏  
  63   2                      DATA[2]=Pcf8591_AD(0);//通道3：可调电阻
  64   2                      
  65   2                      value=(float)DATA[0]*5/256;
  66   2                      sprintf(print,"res：%.1f",value);
  67   2                      uart_send_str(print);//输出到串口
  68   2                      
  69   2                      value=(float)DATA[1]*5/256;
  70   2                      sprintf(print,"light：%.1f",value);
  71   2                      uart_send_str(print);//输出到串口
  72   2                      
  73   2                      value=(float)DATA[2]*5/256;
  74   2                      sprintf(print,"heat：%.1f",value);
  75   2                      uart_send_str(print);//输出到串口
  76   2      
  77   2      //              if(value>2.5) led=
  78   2               
  79   2              }
  80   1      }
  81          
  82          //叮(一个周期高250us低250us，共500个周期，0.25秒)，咚(一个周期高500us低500us，共250个周期，0.25秒)
  83          void time0() interrupt 1
  84          {
  85   1              if(flag==0)
  86   1              {  
  87   2                      n0++;
  88   2                      if(n0==1000)            
  89   2                      {
  90   3                              n0=0;
  91   3                              flag=1;
  92   3                      }
  93   2                      else
  94   2                      {
  95   3                              beep=~beep;
  96   3                      }
  97   2              }
  98   1              else
  99   1              {                                          //通过改变定时计数时间可以改变门铃的声音
 100   2                      n1++;                     //叮
 101   2                      if(n1==1000)
 102   2                      {
 103   3                              n1=0;
 104   3                              TR0=0;
 105   3                              flag=0;
 106   3                      }
 107   2                      else
 108   2                      {
 109   3                              if(n1%2==0)     beep=~beep;
 110   3                      }
 111   2              }
 112   1      }                                                                                                                                


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    459    ----
   CONSTANT SIZE    =     33    ----
C51 COMPILER V9.00   MAIN                                                                  12/18/2019 21:19:13 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      17
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
