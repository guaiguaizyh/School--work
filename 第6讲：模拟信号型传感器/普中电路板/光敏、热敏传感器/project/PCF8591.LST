C51 COMPILER V9.00   PCF8591                                                               12/18/2019 21:19:14 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PCF8591
OBJECT MODULE PLACED IN PCF8591.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\KEIL\C51\BIN\C51.EXE PCF8591.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <PCF8591.h> 
   2          
   3          u8 D[32];
   4          
   5          u8 Pcf8591_DA(u8 Val)//数字转模拟，val为数字信号值，转换成功返回1，否则返回0
   6          {
   7   1         u8 ack;
   8   1         I2C_Start();              //启动总线
   9   1         ack=I2C_SendByte(AddWr);   //发送器件地址+写
  10   1         if(ack==0)return(0);         //无应答则结束
  11   1         ack=I2C_SendByte(0x40);   //使能数字转换模拟
  12   1         if(ack==0)return(0);           //无应答则结束
  13   1         ack=I2C_SendByte(Val);     //发送数字信号值  
  14   1         if(ack==0)return(0);           //无应答则结束
  15   1         I2C_Stop();               //结束总线
  16   1         return(1);
  17   1      }
  18          
  19          u8 Pcf8591_AD(u8 channel)//模拟转数字，channel为模拟信号通道号(0-3)，转换成功则返回数字值，否则返回0
  20          {
  21   1         u8 ack,dat;
  22   1         //启动转换
  23   1         I2C_Start();            //启动总线
  24   1         ack=I2C_SendByte(AddWr);            //发送器件地址 +写
  25   1         if(ack==0)return(0);           //无应答则结束
  26   1         ack=I2C_SendByte(channel);   //发送通道选择控制字
  27   1         if(ack==0)return(0);    //无应答则结束
  28   1         I2C_Stop();             //结束总线
  29   1      
  30   1         //读取转换值
  31   1         I2C_Start();         //启动总线
  32   1         ack=I2C_SendByte(AddWr+1);     //发送器件地址 +读
  33   1         if(ack==0)return(0);    //无应答则结束
  34   1         dat=I2C_RcvByte();      //读取转换数字值
  35   1      
  36   1         I2C_Ack(1);           //发送非应答信号
  37   1         I2C_Stop();           //结束总线
  38   1         return(dat);
  39   1      }
  40           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     98    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
