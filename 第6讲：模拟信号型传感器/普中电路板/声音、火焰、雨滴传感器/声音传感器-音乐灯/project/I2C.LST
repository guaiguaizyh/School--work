C51 COMPILER V9.00   I2C                                                                   12/16/2019 08:57:25 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN I2C.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE I2C.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <I2C.h> 
   2          
   3          void I2C_Start() //启动I2C总线  
   4          {
   5   1        sda=1;         /*发送起始条件的数据信号*/
   6   1        _nop_();
   7   1        scl=1;
   8   1        _nop_();        /*起始条件建立时间大于4.7us,延时*/
   9   1        _nop_();
  10   1        _nop_();
  11   1        _nop_();
  12   1        _nop_();    
  13   1        sda=0;         /*发送起始信号*/
  14   1        _nop_();        /* 起始条件锁定时间大于4μs*/
  15   1        _nop_();
  16   1        _nop_();
  17   1        _nop_();
  18   1        _nop_();       
  19   1        scl=0;       /*钳住I2C总线，准备发送或接收数据 */
  20   1        _nop_();
  21   1        _nop_();
  22   1      }
  23          
  24          void I2C_Stop() //停止(结束)I2C总线
  25          {
  26   1        sda=0;      /*发送结束条件的数据信号*/
  27   1        _nop_();    /*发送结束条件的时钟信号*/
  28   1        scl=1;      /*结束条件建立时间大于4μs*/
  29   1        _nop_();
  30   1        _nop_();
  31   1        _nop_();
  32   1        _nop_();
  33   1        _nop_();
  34   1        sda=1;      /*发送I2C总线结束信号*/
  35   1        _nop_();
  36   1        _nop_();
  37   1        _nop_();
  38   1        _nop_();
  39   1      }
  40          
  41          u8  I2C_SendByte(u8 c)//发送1个字节数据，从机应答返回1，从机不应答返回0  
  42          {
  43   1       u8  i,ack;
  44   1       for(i=0;i<8;i++)  /*要传送的数据长度为8位*/
  45   1          {
  46   2           if((c<<i)&0x80)sda=1;   /*判断发送位*/
  47   2             else  sda=0;                
  48   2           _nop_();
  49   2           scl=1;               /*置时钟线为高，通知被控器开始接收数据位*/
  50   2            _nop_(); 
  51   2            _nop_();             /*保证时钟高电平周期大于4μs*/
  52   2            _nop_();
  53   2            _nop_();
  54   2            _nop_();         
  55   2           scl=0; 
C51 COMPILER V9.00   I2C                                                                   12/16/2019 08:57:25 PAGE 2   

  56   2          }
  57   1          
  58   1          _nop_();
  59   1          _nop_();
  60   1          sda=1;                /*8位发送完后释放数据线，准备接收应答位*/
  61   1          _nop_();
  62   1          _nop_();   
  63   1          scl=1;
  64   1          _nop_();
  65   1          _nop_();
  66   1          _nop_();
  67   1          if(sda==1)ack=0;     
  68   1             else ack=1;        /*判断是否接收到应答信号*/
  69   1          scl=0;
  70   1          _nop_();
  71   1          _nop_();
  72   1              return ack;
  73   1      }
  74           
  75          u8 I2C_RcvByte()//接收1个字节数据
  76          {
  77   1        u8 retc=0,i; 
  78   1        sda=1;                     /*置数据线为输入方式*/
  79   1        for(i=0;i<8;i++)
  80   1            {
  81   2              _nop_();           
  82   2              scl=0;                  /*置时钟线为低，准备接收数据位*/
  83   2              _nop_();
  84   2              _nop_();                 /*时钟低电平周期大于4.7μs*/
  85   2              _nop_();
  86   2              _nop_();
  87   2              _nop_();
  88   2              scl=1;                  /*置时钟线为高使数据线上数据有效*/
  89   2              _nop_();
  90   2              _nop_();
  91   2              retc=retc<<1;
  92   2              if(sda==1)retc=retc+1;  /*读数据位,接收的数据位放入retc中 */
  93   2              _nop_();
  94   2              _nop_(); 
  95   2            }
  96   1        scl=0;    
  97   1        _nop_();
  98   1        _nop_();
  99   1        return(retc);
 100   1      }
 101          
 102          void I2C_Ack(bit a)     // 发送应答或非应答信号(a=0:应答，a=1:非应答)
 103          {  
 104   1        if(a==0)sda=0;              /*在此发出应答或非应答信号 */
 105   1        else sda=1;                             /*0为发出应答，1为非应答信号 */
 106   1        _nop_();
 107   1        _nop_();
 108   1        _nop_();      
 109   1        scl=1;
 110   1        _nop_();
 111   1        _nop_();                    /*时钟低电平周期大于4μs*/
 112   1        _nop_();
 113   1        _nop_();
 114   1        _nop_();  
 115   1        scl=0;                     /*清时钟线，住I2C总线以便继续接收*/
 116   1        _nop_();
 117   1        _nop_();    
C51 COMPILER V9.00   I2C                                                                   12/16/2019 08:57:25 PAGE 3   

 118   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    161    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
