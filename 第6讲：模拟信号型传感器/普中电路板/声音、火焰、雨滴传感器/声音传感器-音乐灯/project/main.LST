C51 COMPILER V9.00   MAIN                                                                  12/16/2019 10:55:00 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //基于天祥电路板
   2          #include <config.h>
   3          
   4          sbit voice=P1^0;
   5          sbit LED1=P2^0;
   6          sbit LED2=P2^1;
   7          sbit LED3=P2^2;
   8          sbit LED4=P2^3;
   9          sbit LED5=P2^4;
  10          sbit LED6=P2^5;
  11          sbit LED7=P2^6;
  12          sbit LED8=P2^7;
  13          
  14           
  15          sbit beep=P2^3;//蜂鸣器 
  16          
  17          u8 flag=0;      //0:叮,1:咚
  18          u16 n0=0,n1=0;  //n0:叮周期计数，n1:咚周期计数
  19          
  20          void delay_us(u16 n)//微秒延时
  21          {
  22   1          while(--n);
  23   1      }
  24          
  25          void delay_ms(u16 x)//毫秒延时函数
  26          {u16 i,j;
  27   1       for(i=0;i<x;i++)
  28   1          for(j=0;j<115;j++);
  29   1      }
  30          
  31          void Alarm(u8 t) //蜂鸣器报警,持续t秒,软件延时
  32          {
  33   1       u8 k; 
  34   1       u16 i,j;               
  35   1       for(k=0;k<t;k++)
  36   1       { for(i=0;i<100;i++)//叮
  37   2            {beep=0;delay_us(250);beep=1;delay_us(250);}
  38   2         for(j=0;j<50;j++)//咚
  39   2            {beep=0;delay_us(500);beep=1;delay_us(500);}
  40   2       }
  41   1      }
  42          
  43          void Alarm_init() //蜂鸣器报警,定时器T0
  44          {
  45   1              TMOD&=0xf0;//定时器T0设为方式2,8位自动装载模式
  46   1          TMOD|=0x02;  
  47   1              TH0=0X00;
  48   1              TL0=0X00; //定时250us
  49   1              EA=1;
  50   1              ET0=1;
  51   1      }
  52          
  53          void Alarm_Power(u8 t) //打开/关闭蜂鸣器报警,定时器T0,1：打开，0：关闭
  54          {
  55   1              TR0=t; 
C51 COMPILER V9.00   MAIN                                                                  12/16/2019 10:55:00 PAGE 2   

  56   1      }
  57          
  58          void main()
  59          {
  60   1              u8 noisy=0;
  61   1              while(1)
  62   1              {
  63   2                      if(voice==1) 
  64   2                      {
  65   3                              LED1=1;
  66   3                  noisy++;
  67   3                  if(noisy>7) noisy=7;
  68   3                          switch(noisy)
  69   3                          {
  70   4                                      case 7:LED8=1;
  71   4                      case 6:LED7=1;
  72   4                                  case 5:LED6=1;
  73   4                                  case 4:LED5=1;
  74   4                                  case 3:LED4=1;
  75   4                                  case 2:LED3=1;
  76   4                                  case 1:LED2=1;
  77   4                              }          
  78   3                 }
  79   2                      else 
  80   2                 {
  81   3                              noisy=0;
  82   3                              P2=0x00;
  83   3                 }    
  84   2             delay_ms(10);                    
  85   2              }
  86   1      } 
  87          
  88          //叮(一个周期高250us低250us，共500个周期，0.25秒)，咚(一个周期高500us低500us，共250个周期，0.25秒)
  89          void time0() interrupt 1
  90          {
  91   1              if(flag==0)
  92   1              {  
  93   2                      n0++;
  94   2                      if(n0==1000)            
  95   2                      {
  96   3                              n0=0;
  97   3                              flag=1;
  98   3                      }
  99   2                      else
 100   2                      {
 101   3                              beep=~beep;
 102   3                      }
 103   2              }
 104   1              else
 105   1              {                                          //通过改变定时计数时间可以改变门铃的声音
 106   2                      n1++;                     //叮
 107   2                      if(n1==1000)
 108   2                      {
 109   3                              n1=0;
 110   3                              TR0=0;
 111   3                              flag=0;
 112   3                      }
 113   2                      else
 114   2                      {
 115   3                              if(n1%2==0)     beep=~beep;
 116   3                      }
 117   2              }
C51 COMPILER V9.00   MAIN                                                                  12/16/2019 10:55:00 PAGE 3   

 118   1      }                                                                                                                                


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    308    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
