C51 COMPILER V9.00   ST7920                                                                12/08/2019 16:59:05 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ST7920
OBJECT MODULE PLACED IN ST7920.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\KEIL\C51\BIN\C51.EXE ST7920.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //»ùÓÚST7920µÄ12864Òº¾§ÏÔÊ¾
   2          #include <ST7920.h>
   3          
   4          #define DATA P0          //Êý¾ÝÊäÈëÊä³ö¶Ë¿Ú 
   5          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};    //ÑÓÊ±4us
   6          u8 row=0; //µ±Ç°¹â±êËùÔÚÎ»ÖÃÐÐ×ø±ê 
   7          u8 col=0; //µ±Ç°¹â±êËùÔÚÎ»ÖÃÁÐ×ø±ê 
   8          
   9          /*12864ST7920¶Ë¿Ú¶¨Òå*/
  10          sbit LCD_RS  =  P3^5;            //¼Ä´æÆ÷Ñ¡ÔñÊäÈë 
  11          sbit LCD_RW  =  P3^6;            //Òº¾§¶Á/Ð´¿ØÖÆ
  12          sbit LCD_EN  =  P3^4;            //Òº¾§Ê¹ÄÜ¿ØÖÆ
  13          sbit LCD_PSB =  P3^7;            //´®/²¢·½Ê½¿ØÖÆ
  14                          
  15          /*******************************************************************/
  16          /*¼ì²éLCDÃ¦×´Ì¬                                                    */
  17          /*lcd_busyÎª1Ê±£¬Ã¦£¬µÈ´ý¡£lcd-busyÎª0Ê±,ÏÐ£¬¿ÉÐ´Ö¸ÁîÓëÊý¾Ý¡£      */
  18          /*******************************************************************/
  19          bit lcd_busy()
  20           {                          
  21   1          bit result;
  22   1          LCD_RS = 0;
  23   1          LCD_RW = 1;
  24   1          LCD_EN = 1;
  25   1          delayNOP();  //ÑÓÊ±4us
  26   1          result = (bit)(DATA&0x80);
  27   1          LCD_EN = 0;
  28   1          return(result); 
  29   1       }
  30          /*******************************************************************/
  31          /*Ð´Ö¸ÁîÊý¾Ýµ½LCD                                                  */
  32          /*RS=L£¬RW=L£¬E=¸ßÂö³å£¬D0-D7=Ö¸ÁîÂë¡£                             */
  33          /*******************************************************************/
  34          void lcd_wcmd(u8 cmd)
  35          {                          
  36   1          while(lcd_busy());
  37   1          LCD_RS = 0;
  38   1          LCD_RW = 0;
  39   1          LCD_EN = 0;
  40   1          _nop_();
  41   1          _nop_(); 
  42   1          DATA = cmd;
  43   1          delayNOP();
  44   1          LCD_EN = 1;
  45   1          delayNOP();
  46   1          LCD_EN = 0;  
  47   1      }
  48          /*******************************************************************/
  49          /*Ð´ÏÔÊ¾Êý¾Ýµ½LCD                                                  */
  50          /*RS=H£¬RW=L£¬E=¸ßÂö³å£¬D0-D7=Êý¾Ý¡£                               */
  51          /*******************************************************************/
  52          void lcd_wdat(u8 dat)
  53          {                          
  54   1          while(lcd_busy());
  55   1          LCD_RS = 1;
C51 COMPILER V9.00   ST7920                                                                12/08/2019 16:59:05 PAGE 2   

  56   1          LCD_RW = 0;
  57   1          LCD_EN = 0;
  58   1          DATA = dat;
  59   1          delayNOP();
  60   1          LCD_EN = 1;
  61   1          delayNOP();
  62   1          LCD_EN = 0; 
  63   1      }
  64          /*******************************************************************/
  65          /*  LCD³õÊ¼»¯Éè¶¨                                                  */
  66          /*******************************************************************/
  67          void ST7920_Init() //³õÊ¼»¯º¯Êý
  68          { 
  69   1      
  70   1          LCD_PSB = 1;         //²¢¿Ú·½Ê½
  71   1          
  72   1      //  lcd_wcmd(0x34);      //À©³äÖ¸Áî²Ù×÷
  73   1      //  delay_ms(5);
  74   1          lcd_wcmd(0x30);      //»ù±¾Ö¸Áî²Ù×÷
  75   1          delay_ms(5);
  76   1          lcd_wcmd(0x0c);      //ÏÔÊ¾¿ª£¬¹Ø¹â±ê
  77   1              delay_ms(5);
  78   1          lcd_wcmd(0x01);      //Çå³ýLCDµÄÏÔÊ¾ÄÚÈÝ
  79   1          delay_ms(5);
  80   1      }
  81          /*********************************************************/
  82          /* Éè¶¨ÏÔÊ¾Î»ÖÃ                                          */
  83          /*********************************************************/
  84          void ST7920_pos(u8 X,u8 Y) //ÉèÖÃÏÔÊ¾×ø±ê,XÐÐ×ø±ê(0-3),YÁÐ×ø±ê(0-7)
  85          {                          
  86   1         u8  pos,a;
  87   1         row=X;
  88   1         col=Y;
  89   1         if (X==0)
  90   1           {a=0x80;}
  91   1         else if (X==1)
  92   1           {a=0x90;}
  93   1         else if (X==2)
  94   1           {a=0x88;}
  95   1         else if (X==3)
  96   1           {a=0x98;}
  97   1         pos = a+Y ;  
  98   1         lcd_wcmd(pos);     //ÏÔÊ¾µØÖ·
  99   1      }
 100          /*********************************************************/
 101          /* ÏÔÊ¾ºº×Ö´®º¯Êý                                                                */
 102          /*********************************************************/
 103          void ST7920_str(u8 *p,u8 x,u8 y)//´ÓÖ¸¶¨Î»ÖÃ¿ªÊ¼ÏÔÊ¾ºº×Ö´®£¨×ÖÊý²»³¬¹ý32£©
 104           {
 105   1          u8 i;
 106   1          ST7920_pos(x,y); //ÉèÖÃÆðÊ¼×ø±ê       
 107   1          i = 0;
 108   1          while(p[i]!= '\0')
 109   1           {                         //ÏÔÊ¾×Ö·û
 110   2             lcd_wdat(p[i]);
 111   2             i++;
 112   2                 lcd_wdat(p[i]);
 113   2             i++;
 114   2                 col++;
 115   2                 if(col%8==0) {row++; row=row%4; col=0; ST7920_pos(row,col);}//Ð´ÂúÒ»ÐÐÊ±¾ÍÌøµ½ÏÂÒ»ÐÐ£»Ò»¸öºº×ÖÕ¼2¸ö×Ö½
             -Ú
 116   2       
C51 COMPILER V9.00   ST7920                                                                12/08/2019 16:59:05 PAGE 3   

 117   2           }             
 118   1      }
 119          void ST7920_word(u8 *p,u8 x,u8 y)//ÔÚÖ¸¶¨Î»ÖÃÏÔÊ¾Ò»¸öºº×Ö
 120          {
 121   1          ST7920_pos(x,y);        
 122   1          lcd_wdat(p[0]);
 123   1              lcd_wdat(p[1]);
 124   1          col++;
 125   1              if(col%8==0) {row++; row=row%4; col=0; ST7920_pos(row,col);}//Ð´ÂúÒ»ÐÐÊ±¾ÍÌøµ½ÏÂÒ»ÐÐ£»Ò»¸öºº×ÖÕ¼2¸ö×Ö½Ú
 126   1      } 
 127          void ST7920_Clear()//ÇåÆÁº¯Êý
 128          { 
 129   1          lcd_wcmd(0x01);      //Çå³ýLCDµÄÏÔÊ¾ÄÚÈÝ
 130   1          delay_ms(5);
 131   1              ST7920_pos(0,0);     //×ø±ê·µ»Øµ½Ê×ÐÐÊ×Î»
 132   1      }
 133          void ST7920_del(u8 x,u8 y)//É¾³ýÖ¸¶¨Î»ÖÃÉÏµÄºº×Ö,²¢ÇÒ¹â±êÒ²ÒÆµ½Ö¸¶¨Î»ÖÃ
 134          { 
 135   1              ST7920_pos(x,y);  
 136   1              lcd_wdat(0xa1); //Ð´ÈëÈ«½ÇµÄ¿Õ¸ñ
 137   1              lcd_wdat(0xa1);
 138   1      }
 139          void ST7920_Clrline(u8 x)//Çå³ýÖ¸¶¨ÐÐ£¬²¢ÇÒ¹â±êÒÆµ½ÐÐÊ×
 140          {
 141   1              u8 i;
 142   1              for(i=0;i<8;i++)
 143   1                      ST7920_del(x,7-i);
 144   1      }
 145          void ST7920_Backspace()//É¾³ý¹â±êÇ°ÃæµÄÒ»¸öºº×Ö,²¢ÇÒ¹â±êÒ²¸ú×Å×óÒÆÒ»Î»
 146          {
 147   1              if(col==0) {if(row>0) {row--;col=7;}}
 148   1              else col--;
 149   1              ST7920_pos(row,col);  
 150   1              lcd_wdat(0xa1);  //Ð´ÈëÈ«½ÇµÄ¿Õ¸ñ
 151   1              lcd_wdat(0xa1);
 152   1      }
 153          void ST7920_pow(u8 x)//´ò¿ª(1)»ò¹Ø±Õ(0)ÏÔÊ¾
 154          { 
 155   1              if(x==1)lcd_wcmd(0x0c); //¿ªÏÔÊ¾
 156   1              if(x==0)lcd_wcmd(0x08); //¹ØÏÔÊ¾
 157   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    362    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
