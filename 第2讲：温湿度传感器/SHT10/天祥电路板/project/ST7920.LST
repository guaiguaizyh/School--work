C51 COMPILER V9.00   ST7920                                                                12/08/2019 17:03:19 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ST7920
OBJECT MODULE PLACED IN ST7920.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\KEIL\C51\BIN\C51.EXE ST7920.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //»ùÓÚST7920µÄ12864Òº¾§ÏÔÊ¾
   2          #include <ST7920.h>
   3          #define DATA P0          //Êý¾ÝÊäÈëÊä³ö¶Ë¿Ú 
   4          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};    //ÑÓÊ±4us
   5          u8 row=0; //µ±Ç°¹â±êËùÔÚÎ»ÖÃÐÐ×ø±ê 
   6          u8 col=0; //µ±Ç°¹â±êËùÔÚÎ»ÖÃÁÐ×ø±ê 
   7          
   8          /*12864ST7920¶Ë¿Ú¶¨Òå*/
   9          sbit LCD_RS  =  P3^5;            //¼Ä´æÆ÷Ñ¡ÔñÊäÈë 
  10          sbit LCD_RW  =  P3^6;            //Òº¾§¶Á/Ð´¿ØÖÆ
  11          sbit LCD_EN  =  P3^4;            //Òº¾§Ê¹ÄÜ¿ØÖÆ
  12          sbit LCD_PSB =  P3^7;            //´®/²¢·½Ê½¿ØÖÆ
  13                          
  14          /*******************************************************************/
  15          /*¼ì²éLCDÃ¦×´Ì¬                                                    */
  16          /*lcd_busyÎª1Ê±£¬Ã¦£¬µÈ´ý¡£lcd-busyÎª0Ê±,ÏÐ£¬¿ÉÐ´Ö¸ÁîÓëÊý¾Ý¡£      */
  17          /*******************************************************************/
  18          bit lcd_busy()
  19           {                          
  20   1          bit result;
  21   1          LCD_RS = 0;
  22   1          LCD_RW = 1;
  23   1          LCD_EN = 1;
  24   1          delayNOP();  //ÑÓÊ±4us
  25   1          result = (bit)(DATA&0x80);
  26   1          LCD_EN = 0;
  27   1          return(result); 
  28   1       }
  29          /*******************************************************************/
  30          /*Ð´Ö¸ÁîÊý¾Ýµ½LCD                                                  */
  31          /*RS=L£¬RW=L£¬E=¸ßÂö³å£¬D0-D7=Ö¸ÁîÂë¡£                             */
  32          /*******************************************************************/
  33          void lcd_wcmd(u8 cmd)
  34          {                          
  35   1          while(lcd_busy());
  36   1          LCD_RS = 0;
  37   1          LCD_RW = 0;
  38   1          LCD_EN = 0;
  39   1          _nop_();
  40   1          _nop_(); 
  41   1          DATA = cmd;
  42   1          delayNOP();
  43   1          LCD_EN = 1;
  44   1          delayNOP();
  45   1          LCD_EN = 0;  
  46   1      }
  47          /*******************************************************************/
  48          /*Ð´ÏÔÊ¾Êý¾Ýµ½LCD                                                  */
  49          /*RS=H£¬RW=L£¬E=¸ßÂö³å£¬D0-D7=Êý¾Ý¡£                               */
  50          /*******************************************************************/
  51          void lcd_wdat(u8 dat)
  52          {                          
  53   1          while(lcd_busy());
  54   1          LCD_RS = 1;
  55   1          LCD_RW = 0;
C51 COMPILER V9.00   ST7920                                                                12/08/2019 17:03:19 PAGE 2   

  56   1          LCD_EN = 0;
  57   1          DATA = dat;
  58   1          delayNOP();
  59   1          LCD_EN = 1;
  60   1          delayNOP();
  61   1          LCD_EN = 0; 
  62   1      }
  63          /*******************************************************************/
  64          /*  LCD³õÊ¼»¯Éè¶¨                                                  */
  65          /*******************************************************************/
  66          void ST7920_Init() //³õÊ¼»¯º¯Êý
  67          { 
  68   1      
  69   1          LCD_PSB = 1;         //²¢¿Ú·½Ê½
  70   1          
  71   1      //  lcd_wcmd(0x34);      //À©³äÖ¸Áî²Ù×÷
  72   1      //  delay_ms(5);
  73   1          lcd_wcmd(0x30);      //»ù±¾Ö¸Áî²Ù×÷
  74   1          delay_ms(5);
  75   1          lcd_wcmd(0x0c);      //ÏÔÊ¾¿ª£¬¹Ø¹â±ê
  76   1              delay_ms(5);
  77   1          lcd_wcmd(0x01);      //Çå³ýLCDµÄÏÔÊ¾ÄÚÈÝ
  78   1          delay_ms(5);
  79   1      }
  80          /*********************************************************/
  81          /* Éè¶¨ÏÔÊ¾Î»ÖÃ                                          */
  82          /*********************************************************/
  83          void ST7920_pos(u8 X,u8 Y) //ÉèÖÃÏÔÊ¾×ø±ê,XÐÐ×ø±ê(0-3),YÁÐ×ø±ê(0-7)
  84          {                          
  85   1         u8  pos,a;
  86   1         row=X;
  87   1         col=Y;
  88   1         if (X==0)
  89   1           {a=0x80;}
  90   1         else if (X==1)
  91   1           {a=0x90;}
  92   1         else if (X==2)
  93   1           {a=0x88;}
  94   1         else if (X==3)
  95   1           {a=0x98;}
  96   1         pos = a+Y ;  
  97   1         lcd_wcmd(pos);     //ÏÔÊ¾µØÖ·
  98   1      }
  99          /*********************************************************/
 100          /* ÏÔÊ¾ºº×Ö´®º¯Êý                                                                */
 101          /*********************************************************/
 102          void ST7920_str(u8 *p,u8 x,u8 y)//´ÓÖ¸¶¨Î»ÖÃ¿ªÊ¼ÏÔÊ¾ºº×Ö´®£¨×ÖÊý²»³¬¹ý32£©
 103           {
 104   1          u8 i;
 105   1          ST7920_pos(x,y); //ÉèÖÃÆðÊ¼×ø±ê       
 106   1          i = 0;
 107   1          while(p[i]!= '\0')
 108   1           {                         //ÏÔÊ¾×Ö·û
 109   2             lcd_wdat(p[i]);
 110   2             i++;
 111   2                 lcd_wdat(p[i]);
 112   2             i++;
 113   2                 col++;
 114   2                 if(col%8==0) {row++; row=row%4; col=0; ST7920_pos(row,col);}//Ð´ÂúÒ»ÐÐÊ±¾ÍÌøµ½ÏÂÒ»ÐÐ£»Ò»¸öºº×ÖÕ¼2¸ö×Ö½
             -Ú
 115   2       
 116   2           }             
C51 COMPILER V9.00   ST7920                                                                12/08/2019 17:03:19 PAGE 3   

 117   1      }
 118          void ST7920_word(u8 *p,u8 x,u8 y)//ÔÚÖ¸¶¨Î»ÖÃÏÔÊ¾Ò»¸öºº×Ö
 119          {
 120   1          ST7920_pos(x,y);        
 121   1          lcd_wdat(p[0]);
 122   1              lcd_wdat(p[1]);
 123   1          col++;
 124   1              if(col%8==0) {row++; row=row%4; col=0; ST7920_pos(row,col);}//Ð´ÂúÒ»ÐÐÊ±¾ÍÌøµ½ÏÂÒ»ÐÐ£»Ò»¸öºº×ÖÕ¼2¸ö×Ö½Ú
 125   1      } 
 126          void ST7920_Clear()//ÇåÆÁº¯Êý
 127          { 
 128   1          lcd_wcmd(0x01);      //Çå³ýLCDµÄÏÔÊ¾ÄÚÈÝ
 129   1          delay_ms(5);
 130   1              ST7920_pos(0,0);     //×ø±ê·µ»Øµ½Ê×ÐÐÊ×Î»
 131   1      }
 132          void ST7920_del(u8 x,u8 y)//É¾³ýÖ¸¶¨Î»ÖÃÉÏµÄºº×Ö,²¢ÇÒ¹â±êÒ²ÒÆµ½Ö¸¶¨Î»ÖÃ
 133          { 
 134   1              ST7920_pos(x,y);  
 135   1              lcd_wdat(0xa1); //Ð´ÈëÈ«½ÇµÄ¿Õ¸ñ
 136   1              lcd_wdat(0xa1);
 137   1      }
 138          void ST7920_Clrline(u8 x)//Çå³ýÖ¸¶¨ÐÐ£¬²¢ÇÒ¹â±êÒÆµ½ÐÐÊ×
 139          {
 140   1              u8 i;
 141   1              for(i=0;i<8;i++)
 142   1                      ST7920_del(x,7-i);
 143   1      }
 144          void ST7920_Backspace()//É¾³ý¹â±êÇ°ÃæµÄÒ»¸öºº×Ö,²¢ÇÒ¹â±êÒ²¸ú×Å×óÒÆÒ»Î»
 145          {
 146   1              if(col==0) {if(row>0) {row--;col=7;}}
 147   1              else col--;
 148   1              ST7920_pos(row,col);  
 149   1              lcd_wdat(0xa1);  //Ð´ÈëÈ«½ÇµÄ¿Õ¸ñ
 150   1              lcd_wdat(0xa1);
 151   1      }
 152          void ST7920_pow(u8 x)//´ò¿ª(1)»ò¹Ø±Õ(0)ÏÔÊ¾
 153          { 
 154   1              if(x==1)lcd_wcmd(0x0c); //¿ªÏÔÊ¾
 155   1              if(x==0)lcd_wcmd(0x08); //¹ØÏÔÊ¾
 156   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    362    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
