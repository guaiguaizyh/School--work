C51 COMPILER V9.00   SHT10                                                                 12/08/2019 15:23:18 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE SHT10
OBJECT MODULE PLACED IN sht10.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\KEIL\C51\BIN\C51.EXE sht10.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <sht10.h>
   2          
   3          #define NOP5() {_nop_();_nop_();_nop_();_nop_();_nop_();}// ÑÓÊ±5Î¢Ãî
   4          
   5          //×¢ÒâSCL¡¢SDAÒª½ÓÉÏÀ­µãµç×è£¬Êµ¼ÊÊ¹ÓÃÊ±Ö»ÄÜ½ÓÌìÏéµçÂ·°åÉÏP0¿Ú£¬ÕâÊ±ÊýÂë¹Ü¡¢1602¡¢12864¶¼²»ÄÜÊ¹ÓÃ£¬Ö»ÄÜ½«½
             -á¹ûËÍ´®¿Ú
   6          sbit SDA=P2^1; 
   7          sbit SCL=P2^0; 
   8          
   9          void Start()//Æô¶¯´«Êä
  10          {
  11   1              SDA = 1;    
  12   1          SCL = 0;    //³õÊ¼×´Ì¬
  13   1              _nop_();
  14   1              SCL = 1;    
  15   1              _nop_();
  16   1              SDA = 0;    
  17   1              _nop_();
  18   1              SCL = 0;    
  19   1              NOP5();
  20   1              SCL = 1;     
  21   1          _nop_();
  22   1              SDA = 1;
  23   1              _nop_();
  24   1              SCL = 0;
  25   1      } 
  26          
  27          void Sht10_Reset()//´«¸ÐÆ÷¸´Î»£¬×´Ì¬¼Ä´æÆ÷µÄÖµ²»±ä
  28          {       
  29   1              u8 i;
  30   1              SDA = 1;    
  31   1          SCL = 0;    //³õÊ¼×´Ì¬
  32   1              for(i = 0; i < 9; i++)
  33   1              {       SCL = 1;
  34   2                      SCL = 0;
  35   2              } 
  36   1              Start();//·¢Æô¶¯´«ÊäÐÅºÅ
  37   1      }
  38          
  39          u8 WriteByte(u8 SendByte)//Ð´ÈëÒ»¸ö×Ö½Ú²¢¶ÁÈ¡Ó¦´ð,·µ»ØÖµÎª0±íÊ¾È·ÈÏ£¬Îª1±íÊ¾Ã»ÓÐÈ·ÈÏ
  40          {
  41   1              u8 i,error;
  42   1              for(i = 0; i < 8; i++)//Ñ­»·Ð´Èë8Î»ÃüÁî£¬ÏÈÐ´¸ßÎ»
  43   1              {
  44   2              SendByte<<=1;
  45   2              SDA=CY; 
  46   2              SCL = 1;      
  47   2                  NOP5();                 
  48   2                  SCL = 0;
  49   2               }
  50   1              SDA = 1;//ÊÍ·ÅSDA£¬ÈÃ´«¸ÐÆ÷·¢Ó¦´ð
  51   1              SCL=1;
  52   1              error=SDA;//SHTÀ­µÍSDA±íÊ¾²âÁ¿½áÊø
  53   1              SCL=0;
  54   1              return error; 
C51 COMPILER V9.00   SHT10                                                                 12/08/2019 15:23:18 PAGE 2   

  55   1      }
  56          
  57          u8 ReadByte(u8 Ack) //¶ÁÈ¡Ò»¸ö×Ö½Ú²¢·¢ËÍÓ¦´ð£¨AckÎª0±íÊ¾Ó¦´ð£¬Îª1±íÊ¾²»Ó¦´ð£©£¬·µ»Ø½ÓÊÕµ½µÄ×Ö½Ú
  58          {
  59   1              u8 i,recbyte=0;
  60   1              SDA=1;//ÊÍ·Å×ÜÏß£¬ÈÃ´«¸ÐÆ÷·¢Êý¾Ý
  61   1              for(i = 0; i < 8; i++)//Ñ­»·Ð´Èë8Î»ÃüÁî£¬ÏÈÐ´¸ßÎ»
  62   1              {
  63   2              SCL=1;
  64   2                      NOP5();
  65   2                      recbyte=(recbyte<<1)|SDA;
  66   2                  SCL = 0;
  67   2               }
  68   1              SDA = Ack;//Ö÷»úÏò´«¸ÐÆ÷·¢Ó¦´ð
  69   1              SCL=1;
  70   1              NOP5();
  71   1              SCL=0;
  72   1              SDA=1;//ÊÍ·Å×ÜÏß£¬ÈÃ´«¸ÐÆ÷¼ÌÐø·¢Êý¾Ý
  73   1              return recbyte; 
  74   1      }
  75          
  76          u8 SoftReset()//Èí¼þ¸´Î»´«¸ÐÆ÷£¬·¢ÃüÁî¸´Î»´«¸ÐÆ÷£¬×´Ì¬¼Ä´æÆ÷µÄÖµÒ²Çå¿Õ;´«¸ÐÆ÷ÓÐÓ¦´ð·µ»Ø0£¬ÎÞ·´Ó¦·µ»Ø1
  77          {       
  78   1          u8 error;
  79   1              Sht10_Reset();
  80   1              error=WriteByte(0x1e);//ÃüÁîÎª£º00011110
  81   1          return error;
  82   1      }       
  83          
  84          u8 ReadStatus(u8 *Status,u8 *Check)//¶Á×´Ì¬¼Ä´æÆ÷¼°Ð£Ñé£¬¶Á³É¹¦·µ»Ø0£¬²»³É¹¦·µ»Ø1
  85          {       
  86   1          u8 error;
  87   1              Start();
  88   1              error=WriteByte(0x07);//·¢¶Á¼Ä´æÆ÷ÃüÁî£º00000111
  89   1          *Status=ReadByte(0); //¶Á×´Ì¬¼Ä´æÆ÷²¢·¢Ó¦´ð
  90   1              *Check=ReadByte(1); //¶ÁÐ£Ñé£¬·¢·ÇÓ¦´ð£¬½áÊøÍ¨ÐÅ
  91   1              return error;
  92   1      }
  93          
  94          u8 WriteStatus(u8 *Status)//Ð´×´Ì¬¼Ä´æÆ÷£¬Ð´³É¹¦·µ»Ø0£¬²»³É¹¦·µ»ØÖµ·Ç0Öµ
  95          {       
  96   1          u8 error;
  97   1              Start();
  98   1              error=WriteByte(0x06);//·¢Ð´¼Ä´æÆ÷ÃüÁî£º00000110
  99   1          error=error+WriteByte(*Status); //Ð´×´Ì¬¼Ä´æÆ÷
 100   1              return error;
 101   1      }
 102          
 103          u8 Sht10_Measure(u16 *Value,u8 *Check,u8 mode)//²âÁ¿ÎÂ¶È¡¢Êª¶È;(mode:0ÎÂ¶È¡¢1Êª¶È)£¬³É¹¦·µ»Ø0£¬²»³É¹¦·µ»Ø·
             -Ç0Öµ
 104          {       u8 error=0,VH,VL;
 105   1              u16  i;
 106   1              Start();//Æô¶¯
 107   1          switch(mode)
 108   1              {case 0:error=WriteByte(0x03);break;//·¢ÎÂ¶È²âÁ¿ÃüÁî£º00000011
 109   2               case 1:error=WriteByte(0x05);break;//·¢Êª¶È²âÁ¿ÃüÁî£º00000101  
 110   2               default:break;
 111   2              }
 112   1              if(error > 0)
 113   1              return error;             //·¢ÃüÁî²»³É¹¦£¬ÔòÍË³ö£¬·µ»Ø·Ç0Öµ
 114   1              
 115   1              for(i = 0; i < 65535; i++)
C51 COMPILER V9.00   SHT10                                                                 12/08/2019 15:23:18 PAGE 3   

 116   1                      if(SDA==0) break;//µÈ´ý´«¸ÐÆ÷²âÁ¿Íê³É£¬Íê³ÉÊ±´«¸ÐÆ÷½«SDAÀ­µÍ
 117   1              if(i==65535)
 118   1              {       error++;
 119   2              return error;      //µÈ´ý´«¸ÐÆ÷²âÁ¿Íê³É£¬²»³É¹¦ÔòÍË³ö£¬·µ»Ø·Ç0Öµ
 120   2              }
 121   1      
 122   1              VH=ReadByte(0); //¶ÁµÚÒ»¸ö×Ö½Ú£¨MSB£©²¢Ó¦´ð
 123   1              VL=ReadByte(0); //¶ÁµÚ¶þ¸ö×Ö½Ú£¨LSB£©²¢Ó¦´ð
 124   1              
 125   1              *Check=ReadByte(1); //¶ÁÐ£ÑéºÍ£¬·¢·ÇÓ¦´ð£¬½áÊøÍ¨ÐÅ
 126   1              *Value=VH*256+VL;  //Í¨¹ýÖ¸ÕëÐÎ²Î·µ»Ø²âÁ¿Öµ
 127   1              return error;     //²âÁ¿Íê³É£¬·µ»Ø0
 128   1      }
 129          
 130          void  Sht10_Convert(u16 Temp,u16 RHum,float *VTemp,float *VRHum)//½«²âÁ¿Öµ×ª»»ÎªÎïÀíÖµ
 131          {
 132   1              float d1 = -40;
 133   1          float d2 = 0.01;
 134   1      
 135   1              float c1 = -4.0;
 136   1              float c2 = +0.0405;
 137   1              float c3 = -2.8E-6;   
 138   1      
 139   1              float t1 = +0.01;
 140   1              float t2 = +0.00008; 
 141   1      //5V£¬14Î»£¬ÉãÊÏÎÂ¶È
 142   1              *VTemp = d1 + d2 * Temp;
 143   1      //12Î»£¬Ïà¶ÔÊª¶È
 144   1              *VRHum=c1+c2*RHum+c3*RHum*RHum; //ÏßÐÔÊª¶È
 145   1              *VRHum=*VRHum+(*VTemp-25)*(t1+t2*RHum); //ÐÞÕýÊª¶È
 146   1              if( *VRHum > 100 ) *VRHum = 100;
 147   1          if( *VRHum < 0.01) *VRHum = 0.01;
 148   1      }
 149          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    775    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      53
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
